version: 2

jobs:
  unix:
    docker:
      - image: ubuntu:18.04

      environment:
        CXX: /usr/bin/g++-8
        CC: /usr/bin/gcc-8

    steps:
      - checkout

      - run:
        name: Install g++-8
        command: "apt-get update && apt-get install -y g++-8"

      - run:
        name: Installing CMAKE
        command: "apt-get update && apt-get install -y cmake"

      - run:
        name: Creating build files
        command: "cmake -H. -Bbuild"

      - run:
        name: Creating test binary
        command: "cmake --build build --target test_binary"

      - run:
        name: Testing project
        command: "./bin/test_binary --success"

  windows:
    docker:
      - image: microsoft/dotnet-framework:4.7.1

    steps:
      - checkout

      - run:
        name: "Download build tools"
        command: "Invoke-WebRequest -OutFile C:\TEMP\vs_buildtools.exe -Uri https://aka.ms/vs/16/release/vs_buildtools.exe"

      - run:
        name: "Install build tools"
        command: |Â C:\TEMP\vs_buildtools.exe --quiet --wait
      --norestart --nocache `
      --installPath C:\BuildTools `
      --channelUri C:\TEMP\VisualStudio.chman `
      --installChannelUri C:\TEMP\VisualStudio.chman `
      --all `
      --remove Microsoft.VisualStudio.Component.Windows10SDK.10240 `
      --remove Microsoft.VisualStudio.Component.Windows10SDK.10586 `
      --remove Microsoft.VisualStudio.Component.Windows10SDK.14393 `
      --remove Microsoft.VisualStudio.Component.Windows81SDK
